sequenceDiagram
    participant U as ðŸ‘¤ Contributor
    participant F as ðŸŽ¨ Frontend
    participant SDK as ðŸ” FHEVM SDK
    participant SV as ðŸ’° ShareVault
    participant CF as ðŸ“ ConfidentialFundraising

    U->>F: Enter contribution amount

    alt User has insufficient vault balance
        F->>SV: deposit(ETH)
        SV->>SV: Encrypt balance on-chain
        SV->>SV: Grant FHE permissions
        SV-->>F: âœ… Deposit successful
    end

    F->>SDK: Encrypt contribution amount
    SDK-->>F: encryptedAmount + proof

    F->>CF: contribute(campaignId, encryptedAmount)
    CF->>CF: Verify campaign is active
    CF->>SV: lockFunds(user, campaignId, encryptedAmount)
    SV->>SV: Lock funds: locked[user][campaign] += amount
    SV-->>CF: âœ… Funds locked
    CF->>CF: Store encrypted contribution
    CF->>CF: Update encrypted totalRaised
    CF-->>F: âœ… Contribution successful
    F-->>U: Show success message

    Note over CF,SV: All amounts remain<br/>encrypted on-chain