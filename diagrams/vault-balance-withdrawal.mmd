---
config:
  look: handDrawn
  theme: neutral
---

sequenceDiagram
    participant U as ðŸ‘¤ User
    participant F as ðŸŽ¨ Frontend
    participant SDK as ðŸ” FHEVM SDK
    participant SV as ðŸ’° ShareVault

    rect rgb(240, 248, 255)
        Note over U,SV: Check Balance
        U->>F: View vault balance
        F->>SV: getEncryptedBalance()
        SV-->>F: encryptedBalance
        F->>SV: getEncryptedTotalLocked()
        SV-->>F: encryptedLocked

        par Decrypt Balance
            F->>SDK: Decrypt balance
            SDK-->>F: decryptedBalance
        and Decrypt Locked
            F->>SDK: Decrypt locked
            SDK-->>F: decryptedLocked
        end

        F->>F: Calculate available:<br/>available = balance - locked
        F-->>U: Show balance breakdown
    end

    rect rgb(240, 255, 240)
        Note over U,SV: Withdraw Funds
        U->>F: Enter withdrawal amount
        F->>F: Verify amount <= available
        F->>SV: withdraw(amount)
        SV->>SV: Verify sufficient balance
        SV->>SV: Update encrypted balance
        SV->>U: Transfer ETH
        SV-->>F: âœ… Withdrawal successful
        F-->>U: "âœ… Withdrawal complete"
    end